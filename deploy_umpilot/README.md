# deploy_umpilot/

collection of scripts used to configure freshly imaged Jetson systems

## Retrieving or creating files excluded from this repository

`scp -P 17422 yourusername@70.142.45.216:/mnt/share/pilot_files/{authorized_keys,wifi_config,ansible1_authorized_keys} files/`

If necessary, add your local public key to `./files/authorized_keys`
and your CI/Ansible-specific key to `./files/ansible1_authorized_keys`
so you can log into the systems you are deploying after disabling SSH password authentication

Note that the better approach might be to direct Ansible to use the individual per-unit private key
generated by `deploy10_afterflash.sh` .

If you ONLY want to rely on the individually generated keys (and also don't use WiFi), you can use this command (no need for scp or adding any keys):

`touch files/{authorized_keys,wifi_config,ansible1_authorized_keys}`

## Imaging a new Auvidea Jetson system to boot from EMMC

1. Connect Power + USB (don't connect network cable yet!)
2. Flash using NVIDIA SDK Manager
3. Run `./deploy10_afterflash.sh NEWHOSTNAME` (NEWHOSTNAME could be jnx22uXXXX, replacing XXXX with the intended unit number)
4. Remove USB cable, connect network cable, power-cycle device
5. If necessary, add NEWHOSTNAME and IP address to /etc/hosts to make unit accessible for Ansible
	1. endudai currently uses the local firewall's DNS service, which also provides DHCP, so the NEWHOSTNAME becomes available if the unit is online

### Variation of above when using eth0 for deploy10:

1. Flash using NVIDIA SDK Manager
2. Remove USB, make sure unit is connected to Ethernet (OK if unit is powered down in between)
3. Run `./deploy10_afterflash.sh NEWHOSTNAME IP` (NEWHOSTAME see above, IP is the IP address which got assigned to the new unit, usually via DHCP)

## The DBDIR ("db/")

"Database" directory. Contains all relevant retrieved/generated/deployed keys (later: configurations, e.g. WLAN?), prefixed with the HOSTNAME_

Ansible inventory can point to that so as to log into a unit, e.g. to `db/jnx22uXXXX_ansible1_ed25519`

A "global" version of DBDIR is maintained on endudai here: `/mnt/share/ansible_db/`

## Running a remote Ansible Playbook

Ansible can use "jump hosts" (software team, please add link or docu here)

## Running an Ansible Playbook on Endudai

(software team, please link or copy the relevant documentation here)

